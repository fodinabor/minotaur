#!/bin/bash

set -e
set -o pipefail

@LLVM_BINARY_DIR@/bin/clang -Xclang -triple -Xclang amdgcn-amd-amdhsa -march=gfx906 -S -O2 -o - $@ | @LLVM_BINARY_DIR@/bin/llvm-mca --mtriple=amdgcn-amd-amdhsa --iterations 1 -mcpu=gfx906 | grep "Total uOps" | tr ' ' '\n' | tail -1
